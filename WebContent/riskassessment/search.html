<div id='searchD'>
	<table border=0>
	<tr>
		<td>
			<label for='queryT' id='queryL' class='toggle'>Service: </label>
			<input type='text' name='queryT' id='queryT' />
			<button id='queryB'>Search</button>
	
			<div id='searchResults'></div>
		</td>
		<td>OR</td>
		<td><button id='createNewRiskButton' >Create a new Risk Assessment</button></td>
	</tr>
	</table>
</div>

<script type='text/javascript'>

function selectRisk(el) {
	//create the cookie
	$.cookie('risk_id', $(el).attr("id"));
	//continue to forms
	$("#searchD").hide();
	pullData("risk");
	$("#riskD").show();
}


$(document).ready(function(){
	
	
	//click on create new risk assessment button
	$("#createNewRiskButton").click(function(){
		$("#searchD").hide();
		pullData("new");
		$("#riskD").show();
	});
	
	
	//page loads
	//get list of existing clients
	$.ajax({
		url: "./rest/risk/allriskassessment/" + $.cookie('user_id') + "/" + $.cookie('auth_token'),
		type:"get",
		contentType: "application/json",
		success: function(d) {
			$("#searchResults").html("");
			var content = "<table>"
			content += "<tr><th>Risk No.</th><th>Service</th><th>Area</th><th>Date</th></tr>";
			for (var i = 0; i < d.existingRiskDetails.length; i++) {
				content += "<tr><td class='fakeLink' id='" + d.existingRiskDetails[i].risk_id + "'onClick='selectRisk(this);'>" + d.existingRiskDetails[i].risk_id + "</td>";
				content += "<td>" + d.existingRiskDetails[i].service + "</td>";
				content += "<td>" + d.existingRiskDetails[i].area + "</td>";
				content += "<td>" + d.existingRiskDetails[i].date + "</td>";
			}
			content += "</table>";
			$("#searchResults").append(content);
		},
		error: function(xhr) {
			// do something to handle error
			alert("error getting existing personal plan details");
		}
	});
	
	
	//click on search button
	$("#queryB").click(function(){
		$.ajax({
			url: "./rest/risk/allclientswithplans/" + $.cookie('user_id') + "/" + $.cookie('auth_token'),
			type:"get",
			contentType: "application/json",
			success: function(d) {
				$("#searchResults").html("");
				var content = "<table>"
					content += "<tr><th>Risk No.</th><th>Service</th><th>Area</th><th>Date</th></tr>";
				for (var i = 0; i < d.existingRiskDetails.length; i++) {
					if(d.existingRiskDetails[i].service == $("#queryT").val() || $("#queryT").val()=="") {
						content += "<tr><td class='fakeLink' id='" + d.existingRiskDetails[i].risk_id + "'onClick='selectRisk(this);'>" + d.existingRiskDetails[i].risk_id + "</td>";
						content += "<td>" + d.existingRiskDetails[i].service + "</td>";
						content += "<td>" + d.existingRiskDetails[i].area + "</td>";
						content += "<td>" + d.existingRiskDetails[i].date + "</td>";
					}
				}
				content += "</table>";
				$("#searchResults").append(content);
			},
			error: function(xhr) {
				// do something to handle error
				alert("error getting existing risk assessment details");
			}
		});
	});
});
</script>