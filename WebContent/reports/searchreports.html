<div id='searchD'>
	<table border=0>
	<tr>
		<td>
			<label for='queryT' id='queryL' class='toggle'>ID: </label>
			<input type='text' name='queryT' id='queryT' />
			<button id='queryB'>Search</button>
	
			<div id='searchResults'></div>
		</td>
	</tr>
	</table>
</div>

<script type='text/javascript'>

function selectPP(el) {
	
	//get the personal plan of the selected client
	
	var a = function(callback)
	{
	
		//pull details
		$.ajax({
			url: "./rest/personalplan/" + $.cookie('user_id') + "/" + $.cookie('auth_token') + "/" + $(el).attr("id"),
			type:"get",
			contentType: "application/json",
			async: false,
			success: callback,
// 			success: function(d) { // d = json returned
				
				
				
// 			},
			error: function(xhr) {
				// do something to handle error
				
			}
		});
	};
	
	a(function(data) {
		console.log(data);
		
		//Create the PDF
		alert("PDF Being Generated");
		
		//Create today's date
		var d =  new Date();
		var month = d.getMonth()+1;
		var day = d.getDate();
		var date = ((''+day).length<2 ? '0' : '') + day + '/' + ((''+month).length<2 ? '0' : '') + month + '/' + d.getFullYear();
			
		//do shit (add shit to pdf)
		var doc = new jsPDF();
		
		//set document properties
		doc.setProperties({
			title: data.clientDetails.personalDetails.preferredName +  ' Personal Plan', 
			subject: 'Client Personal Plan',
			author: $.cookie('user_id'),
		});
		
		//Personal plan title centered
		doc.setFontType("bold");
		doc.text(90, 10, 'Personal Plan');
		
		/* -------------------------------- CLIENT DETAILS --------------------------------------*/
		doc.text(10, 15, 'Client Details');
		//Personal details
		doc.text(10, 20, 'Personal Details');
		doc.setFontType("normal"); //set font type back to normal
		doc.text(10, 25, 'Creation Date: ' + data.clientDetails.personalDetails.creationDate);
		doc.text(10, 30, 'Preferred Name: ' + data.clientDetails.personalDetails.preferredName);
		doc.text(10, 35, 'Review Date: ' + data.clientDetails.personalDetails.reviewDate);
		doc.text(10, 40, 'Date of Birth: ' + data.clientDetails.personalDetails.dob);
		doc.text(10, 45, 'Email Address: ' + data.clientDetails.personalDetails.email);
		doc.text(10, 50, 'Phone Number: ' + data.clientDetails.personalDetails.phoneNumber);
		doc.text(10, 55, 'Mobile Number: ' + data.clientDetails.personalDetails.mobileNumber);
		//Alert information
		doc.setFontType("bold");
		doc.text(10, 65, 'Alert Information');
		doc.setFontType("normal");
		doc.text(10, 70, 'Allergies: ' +  data.clientDetails.alertInformation.allergies);
		doc.text(10, 75, 'Complex Support Needs: ' +  data.clientDetails.alertInformation.complexSupportNeeds);
		doc.text(10, 80, 'Eating Alerts: ' +  data.clientDetails.alertInformation.eatingAlerts);
		doc.text(10, 85, 'Guardian Orders: ' +  data.clientDetails.alertInformation.guardianOrders);
		doc.text(10, 90, 'Medical Issues: ' +  data.clientDetails.alertInformation.medIssues);
		doc.text(10, 95, 'Other Info: ' +  data.clientDetails.alertInformation.otherInfo);
		doc.text(10, 100, 'Phobias: ' +  data.clientDetails.alertInformation.phobias);
		doc.text(10, 105, 'Restrictive: ' +  data.clientDetails.alertInformation.restrictive);
		doc.text(10, 110, 'Safety Concerns: ' +  data.clientDetails.alertInformation.safetyConcerns);
		
		//Formal orders
		doc.setFontType("bold");
		doc.text(10, 120, 'Formal Orders');
		doc.setFontType("normal"); 
		doc.text(10, 125, 'Appointee: ' + data.clientDetails.formalOrders.appointee);
		doc.text(10, 130, 'Commence Date: ' + data.clientDetails.formalOrders.commenceDate);
		doc.text(10, 135, 'Contact Arrangement: ' + data.clientDetails.formalOrders.contactArrangement);
		doc.text(10, 140, 'Details: ' + data.clientDetails.formalOrders.details);
		doc.text(10, 145, 'Family Contact: ' + data.clientDetails.formalOrders.familyContact);
		doc.text(10, 150, 'Justice Requirements: ' + data.clientDetails.formalOrders.justiceRequirements);
		doc.text(10, 155, 'Order For: ' + data.clientDetails.formalOrders.orderFor);
		doc.text(10, 160, 'Order Location: ' + data.clientDetails.formalOrders.orderLocation);
		doc.text(10, 165, 'Other Information: ' + data.clientDetails.formalOrders.otherInfo);
		doc.text(10, 170, 'Protection Order: ' + data.clientDetails.formalOrders.protectionOrder);
		doc.text(10, 175, 'Special Conditions: ' + data.clientDetails.formalOrders.specialConditions);
		doc.text(10, 180, 'Child Support Officer: ' + data.clientDetails.formalOrders.childSupportOfficer);
		doc.text(10, 185, 'Visitor Information: ' + data.clientDetails.formalOrders.visitorInfo);
		
		//Living arrangements
		doc.setFontType("bold");
		doc.text(10, 195, 'Living Arrangements');
		doc.setFontType("normal"); 
		
		
		doc.addPage();
		
		/* -------------------------------- HEALTH DETAILS --------------------------------------*/
		doc.setFontType("bold");
		doc.text(10, 200, 'Health Details');
		//Dietary requirements
		doc.text(10, 205, 'Dietary Requirements');
		doc.setFontType("normal");
		
		//Health information
		doc.setFontType("bold");
		doc.text(10, 215, 'Health Information');
		doc.setFontType("normal");
		
		//Health management
		doc.setFontType("bold");
		doc.text(10, 225, 'Health Management');
		doc.setFontType("normal");
		
		
		/* -------------------------------- COMMUNICATION --------------------------------------*/
		doc.setFontType("bold");
		doc.text(10, 240, 'Communication');
		doc.setFontType("normal");
		
		
		
		

		
		
		
		
		
		
		
		
		/* ------------------------------ CLIENT DETAILS --------------------------------------- */
// 			//Personal details
// 			var personalDetails = new Object();		
// 			personalDetails.creationDate = data.clientDetails.personalDetails.creationDate;
// 			personalDetails.preferredName = data.clientDetails.personalDetails.preferredName;
// 			personalDetails.reviewDate = data.clientDetails.personalDetails.reviewDate;
// 			personalDetails.dob = data.clientDetails.personalDetails.dob;
// 			personalDetails.email = data.clientDetails.personalDetails.email;
// 			personalDetails.phoneNumber = data.clientDetails.personalDetails.phoneNumber;
// 			personalDetails.mobileNumber = data.clientDetails.personalDetails.mobileNumber;
		
		//Alert information
		var alertInformation = new Object();

		
		//Formal orders
		var formalOrders = new Object();

		
		//Living arrangements
		var livingArangements = new Object();
		livingArangements.address = data.clientDetails.livingArangements.address;		
		livingArangements.phoneNumber = data.clientDetails.livingArangements.phoneNumber;
		livingArangements.service = data.clientDetails.livingArangements.service;
		livingArangements.sickContact = data.clientDetails.livingArangements.sickContact;
		
// 		//Add data to the clientdetails object
// 		var clientDetails = new Object();
// 		clientDetails.personalDetails = personalDetails;
// 		clientDetails.alertInformation = alertInformation;
// 		clientDetails.formalOrders = formalOrders;
// 		clientDetails.livingArangements = livingArangements;
		
		/* ----------------------------- HEALTH DETAILS --------------------------------------- */
		//Dietary requirements
		var dietaryRequirements = new Object();
		dietaryRequirements.assessmentDone = data.healthDetails.dietaryRequirements.assessmentDone;
		dietaryRequirements.avoidFood = data.healthDetails.dietaryRequirements.avoidFood;
		dietaryRequirements.breakfast = data.healthDetails.dietaryRequirements.breakfast;
		dietaryRequirements.cannotEat = data.healthDetails.dietaryRequirements.cannotEat;
		dietaryRequirements.dinner = data.healthDetails.dietaryRequirements.dinner;
		dietaryRequirements.dislikes = data.healthDetails.dietaryRequirements.dislikes;
		dietaryRequirements.eatingSupport = data.healthDetails.dietaryRequirements.eatingSupport;
		dietaryRequirements.location = data.healthDetails.dietaryRequirements.location;
		dietaryRequirements.lunch = data.healthDetails.dietaryRequirements.lunch;
		dietaryRequirements.otherInfo = data.healthDetails.dietaryRequirements.otherInfo;
		dietaryRequirements.snacks = data.healthDetails.dietaryRequirements.snacks;
		dietaryRequirements.supportDrinking = data.healthDetails.dietaryRequirements.supportDrinking;
		dietaryRequirements.usualDiet = data.healthDetails.dietaryRequirements.usualDiet;
		
		//Health information
		var healthInformation = new Object();
		healthInformation.additionalInfo = data.healthDetails.healthInformation.additionalInfo;
		healthInformation.assistanceWithMedication = data.healthDetails.healthInformation.assistanceWithMedication;
		healthInformation.conditions = data.healthDetails.healthInformation.conditions;
		healthInformation.historyAndInfo = data.healthDetails.healthInformation.historyAndInfo;
		healthInformation.selfMedicate = data.healthDetails.healthInformation.selfMedicate;
		healthInformation.takeMedication = data.healthDetails.healthInformation.takeMedication;
		
		//Health management
		var healthManagement = new Object();
		healthManagement.duration = data.healthDetails.healthManagement.duration;
		healthManagement.frequency = data.healthDetails.healthManagement.frequency;
		healthManagement.frequencyPeriod = data.healthDetails.healthManagement.frequencyPeriod;
		healthManagement.medicalCondition = data.healthDetails.healthManagement.medicalCondition;
		healthManagement.precurser = data.healthDetails.healthManagement.precurser;
		healthManagement.seizureBrief = data.healthDetails.healthManagement.seizureBrief;
		healthManagement.seizureNonBrief = data.healthDetails.healthManagement.seizureNonBrief;
		healthManagement.staffRespsonse = data.healthDetails.healthManagement.staffResponse;
		healthManagement.symptom = data.healthDetails.healthManagement.symptom;
		healthManagement.symptomAvoidance = data.healthDetails.healthManagement.symptomAvoidance;
				
		//Add data to the health details object
		var healthDetails = new Object();
		healthDetails.dietaryRequirements = dietaryRequirements;
		healthDetails.healthInformation = healthInformation;
		healthDetails.healthManagement = healthManagement;
		
		/* ---------------------------- COMMUNICATION --------------------------------------- */
		//Coms and decision making
		var comsAndDecisionMaking = new Object();
// 			comsAndDecisionMaking.dislikes = data.communication.comsAndDecisionMaking.dislikes;
// 			//do not talk about object
// 			var doNotTalkAbout = new Object();
// 			doNotTalkAbout.topic = data.communication.comsAndDecisionMaking.doNotTalkAbout.topic;
// 			doNotTalkAbout.translation = data.communication.comsAndDecisionMaking.doNotTalkAbout.translation;
// 			//add 
// 			comsAndDecisionMaking.doNotTalkAbout = doNotTalkAbout;
		
		comsAndDecisionMaking.dislikes = data.communication.comsAndDecisionMaking.dislikes;
		comsAndDecisionMaking.goodTopics = data.communication.comsAndDecisionMaking.goodTopics;
		comsAndDecisionMaking.iCommunicate = data.communication.comsAndDecisionMaking.iCommunicate;
		comsAndDecisionMaking.independantDecisions = data.communication.comsAndDecisionMaking.independantDecisions;
		comsAndDecisionMaking.likes = data.communication.comsAndDecisionMaking.likes;
		comsAndDecisionMaking.supportMeBy = data.communication.comsAndDecisionMaking.supportMeBy;
		comsAndDecisionMaking.supportPeople = data.communication.comsAndDecisionMaking.supportPeople;
		comsAndDecisionMaking.youCommunicate = data.communication.comsAndDecisionMaking.youCommunicate;
		
		var communication = new Object();
		communication.comsAndDecisionMaking = comsAndDecisionMaking;
		
		/* ------------------------- EDUCATION EMPLOYMENT --------------------------------------- */
		//Education
		var education = new Object();
		education.address = data.educationEmployment.education.address;
		education.communityAssistance = data.educationEmployment.education.communityAssistance;
		education.contactPerson = data.educationEmployment.education.contactPerson;
		education.eduSupportPlan = data.educationEmployment.education.eduSupportPlan;
		education.enrolledCourse = data.educationEmployment.education.enrolledCourse;
		education.institutionName = data.educationEmployment.education.institutionName;
		education.liaison = data.educationEmployment.education.liason;
		education.otherSupportRequired = data.educationEmployment.education.otherSupportRequired;
		education.studySupport = data.educationEmployment.education.studySupport;
		education.supportPersons = data.educationEmployment.education.supportPersons;
		education.teacher = data.educationEmployment.education.teacher;
		
		//Employment
		var employment = new Object();
		employment.address = data.educationEmployment.employment.address;
		employment.annualLeave = data.educationEmployment.employment.annualLeave;
		employment.arrangements = data.educationEmployment.employment.arrangements;
		employment.contactPerson = data.educationEmployment.employment.contactPerson;
		employment.employer = data.educationEmployment.employment.employer;
		employment.equipment = data.educationEmployment.employment.equipment;
		employment.position = data.educationEmployment.employment.position;
		employment.sickLeave = data.educationEmployment.employment.sickLeave;
		employment.transport = data.educationEmployment.employment.transport;
		
		//Add data to education employment object
		var educationEmployment = new Object();
		educationEmployment.education = education;
		educationEmployment.employment = employment;
		
		/* --------------------------- PLANNING ------------------------------------------------- */
		//Holiday plan
		var holidayPlan = new Object();
		holidayPlan.holidayType = data.planning.holidayPlan.holidayType;
		holidayPlan.detailsAndInfo = data.planning.holidayPlan.detailsAndInfo;
		holidayPlan.howWhoWhere = data.planning.holidayPlan.howWhoWhere;
		holidayPlan.resourcesRequired = data.planning.holidayPlan.resourcesRequired;
		holidayPlan.strategies = data.planning.holidayPlan.strategies;
		holidayPlan.timeframes = data.planning.holidayPlan.timeframes;
		//Goal plan
        var goalPlan = new Object();
		goalPlan.goalToAchieve = data.planning.goalPlan.goalToAchieve;
		goalPlan.howWhoWhere = data.planning.goalPlan.howWhoWhere;
		goalPlan.outcomes = data.planning.goalPlan.outcomes;
		goalPlan.resourcesRequired = data.planning.goalPlan.resourcesRequired;
		goalPlan.strategies = data.planning.goalPlan.strategies;
		goalPlan.timeframes = data.planning.goalPlan.timeframes;
	
        var planning = new Object();
        planning.holidayPlan = holidayPlan;
        planning.goalPlan = goalPlan;
		
		/* ---------------------- SUPPORT REQUIRED ---------------------------------------------- */
		//General support
		var generalSupport = new Object();
		generalSupport.crowdSafety = data.supportRequired.generalSupport.crowdSafety;
		generalSupport.strangerDanger = data.supportRequired.generalSupport.strangerDanger;
		generalSupport.moneyHandling = data.supportRequired.generalSupport.moneyHandling;
		generalSupport.crowds = data.supportRequired.generalSupport.crowds;
		generalSupport.socialNetworks = data.supportRequired.generalSupport.socialNetworks;
		generalSupport.communications = data.supportRequired.generalSupport.communications;
		generalSupport.eatingOut = data.supportRequired.generalSupport.eatingOut;
		generalSupport.beliefs = data.supportRequired.generalSupport.beliefs;
		generalSupport.lesiure = data.supportRequired.generalSupport.leisure;
		generalSupport.usingApplicances = data.supportRequired.generalSupport.usingApplicances;
		generalSupport.usingChemical = data.supportRequired.generalSupport.usingChemical;
		generalSupport.hazardRecognition = data.supportRequired.generalSupport.hazardRecognition;
		generalSupport.otherSafetyInfo = data.supportRequired.generalSupport.otherSafetyInfo;
	
		//mobility and transport
		var mobilityAndTransport = new Object();
		mobilityAndTransport.height = data.supportRequired.mobilityAndTransport.height;
		mobilityAndTransport.liftsAndEscalators = data.supportRequired.mobilityAndTransport.liftsAndEscalators;
		mobilityAndTransport.mobilityAids = data.supportRequired.mobilityAndTransport.mobilityAids;
		mobilityAndTransport.otherTravelSupport = data.supportRequired.mobilityAndTransport.otherTravelSupport;
		mobilityAndTransport.publicTransport = data.supportRequired.mobilityAndTransport.publicTransport;
		mobilityAndTransport.roadSafetySkills = data.supportRequired.mobilityAndTransport.roadSafetySkills;
		mobilityAndTransport.travelPreferences = data.supportRequired.mobilityAndTransport.travelPreferences;
		mobilityAndTransport.unevenSurfaces = data.supportRequired.mobilityAndTransport.unevenSurfaces;
		
		//financial support
		var financialSupport = new Object();
		financialSupport.budgetBills = data.supportRequired.financialSupport.budgetBills; 
		financialSupport.budgetConstraintGoal = data.supportRequired.financialSupport.budgetConstraintGoal;
		financialSupport.budgetEmergency = data.supportRequired.financialSupport.budgetEmergency;
		financialSupport.budgetExpend = data.supportRequired.financialSupport.budgetExpend;
		financialSupport.budgetGroceries = data.supportRequired.financialSupport.budgetGroceries;
		financialSupport.budgetHouse = data.supportRequired.financialSupport.budgetHouse;
		financialSupport.budgetSupportNetwork = data.supportRequired.financialSupport.budgetSupportNetwork;
		financialSupport.budgetTransport = data.supportRequired.financialSupport.budgetTransport;
		financialSupport.budgetUtilities = data.supportRequired.financialSupport.budgetUtilities;
		financialSupport.budgeting = data.supportRequired.financialSupport.budgeting;
		financialSupport.financialAdmin = data.supportRequired.financialSupport.financialAdmin;
		financialSupport.moneyHandlingSupport = data.supportRequired.financialSupport.moneyHandlingSupport;
		financialSupport.otherRequirements = data.supportRequired.financialSupport.otherRequirements;
		financialSupport.personalItemsSupport = data.supportRequired.financialSupport.personalItemsSupport;
		
		//Daily activities
		var dailyActivities = new Object();
		dailyActivities.bathing = data.supportRequired.dailyActivities.bathing;
		dailyActivities.bedTime = data.supportRequired.dailyActivities.bedTime;
		dailyActivities.cleaning = data.supportRequired.dailyActivities.cleaning;
		dailyActivities.cooking = data.supportRequired.dailyActivities.cooking;
		dailyActivities.dressing = data.supportRequired.dailyActivities.dressing;
		dailyActivities.friday = data.supportRequired.dailyActivities.friday;
		dailyActivities.menstruation = data.supportRequired.dailyActivities.menstruation;
		dailyActivities.monday = data.supportRequired.dailyActivities.monday;
		dailyActivities.otherThings = data.supportRequired.dailyActivities.otherThings;
		dailyActivities.routineAfternoon = data.supportRequired.dailyActivities.routineAfternoon;
		dailyActivities.routineMealTime = data.supportRequired.dailyActivities.routineMealTime;
		dailyActivities.routineMorning = data.supportRequired.dailyActivities.routineMorning;
		dailyActivities.routineSleeping = data.supportRequired.dailyActivities.routineSleeping;
		dailyActivities.routineWeekend = data.supportRequired.dailyActivities.routineWeekend;
		dailyActivities.saturday = data.supportRequired.dailyActivities.saturday;
		dailyActivities.sleeping = data.supportRequired.dailyActivities.sleeping;
		dailyActivities.sunday = data.supportRequired.dailyActivities.sunday;
		dailyActivities.thursday = data.supportRequired.dailyActivities.thursday;
		dailyActivities.toileting = data.supportRequired.dailyActivities.toileting;
		dailyActivities.tuesday = data.supportRequired.dailyActivities.tuesday;
		dailyActivities.wednesday = data.supportRequired.dailyActivities.wednesday;
	
		//relaxation
		var relaxation = new Object();
		relaxation.activities = data.supportRequired.relaxation.activities;
		relaxation.movie = data.supportRequired.relaxation.movie;
		relaxation.music = data.supportRequired.relaxation.music;
		relaxation.otherActivities = data.supportRequired.relaxation.otherActivities;
		relaxation.tVShow = data.supportRequired.relaxation.tVShow;
		
		var supportRequired = new Object();
		supportRequired.generalSupport = generalSupport;
		supportRequired.mobilityAndTransport = mobilityAndTransport;
		supportRequired.financialSupport = financialSupport;
		supportRequired.dailyActivities = dailyActivities;
		supportRequired.relaxation = relaxation;
		
// 		//Add data to personal plan
// 		personalPlan.clientDetails = clientDetails;
// 		personalPlan.healthDetails = healthDetails;
// 		personalPlan.communication = communication;
// 		personalPlan.edcuationEmployment = educationEmployment;
// 		personalPlan.planning = planning;
// 		personalPlan.supportRequired = supportRequired;
			
			
			
		//Prompt the user to save the pdf
		doc.save($(el).attr("id") + '_personal_plan' + date);
	});

}


$(document).ready(function(){
	
	//page loads
	//get list of existing clients
	$.ajax({
		url: "./rest/personalplan/allclientswithplans/" + $.cookie('user_id') + "/" + $.cookie('auth_token'),
		type:"get",
		contentType: "application/json",
		success: function(d) {
			$("#searchResults").html("");
			var content = "<table>"
			content += "<tr><th>Client ID</th><th>Name</th><th>DOB</th><th>Mobile</th><th>Telephone</th></tr>";
			for (var i = 0; i < d.existingPlanDetails.length; i++) {
				content += "<tr><td class='fakeLink' id='" + d.existingPlanDetails[i].user_id + "'onClick='selectPP(this);'>" + d.existingPlanDetails[i].user_id + "</td>";
				content += "<td>" + d.existingPlanDetails[i].rName + "</td>";
				content += "<td>" + d.existingPlanDetails[i].dob + "</td>";
				content += "<td>" + d.existingPlanDetails[i].mobile + "</td>";
				content += "<td>" + d.existingPlanDetails[i].telephone + "</td></tr>";
			}
			content += "</table>";
			$("#searchResults").append(content);
		},
		error: function(xhr) {
			// do something to handle error
			alert("error getting existing personal plan details");
		}
	});
	
	
	//click on search button
	$("#queryB").click(function(){
		$.ajax({
			url: "./rest/personalplan/allclientswithplans/" + $.cookie('user_id') + "/" + $.cookie('auth_token'),
			type:"get",
			contentType: "application/json",
			success: function(d) {
				$("#searchResults").html("");
				var content = "<table>"
				content += "<tr><th>Client ID</th><th>Name</th><th>DOB</th><th>Mobile</th><th>Telephone</th></tr>";
				for (var i = 0; i < d.existingPlanDetails.length; i++) {
					if(d.existingPlanDetails[i].user_id == $("#queryT").val() || $("#queryT").val()=="") {
						content += "<tr><td>" + d.existingPlanDetails[i].user_id + "</td>";
						content += "<td>" + d.existingPlanDetails[i].rName + "</td>";
						content += "<td>" + d.existingPlanDetails[i].dob + "</td>";
						content += "<td>" + d.existingPlanDetails[i].mobile + "</td>";
						content += "<td>" + d.existingPlanDetails[i].telephone + "</td></tr>";
					}
				}
				content += "</table>";
				$("#searchResults").append(content);
			},
			error: function(xhr) {
				// do something to handle error
				alert("error getting existing personal plan details");
			}
		});
	});
});
</script>