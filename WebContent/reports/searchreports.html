<div id='searchD'>
	<table border=0>
	<tr>
		<td>
			<label for='queryT' id='queryL' class='toggle'>ID: </label>
			<input type='text' name='queryT' id='queryT' />
			<button id='queryB'>Search</button>
	
			<div id='searchResults'></div>
		</td>
	</tr>
	</table>
</div>

<script type='text/javascript'>

function selectPP(el) {
	
	//create new pdf(report) of personal plan clicked
	
	//Create clientname variable
	var clientName = "";
	//Create new personal plan object
	var personalPlan = new Object();
	
	//get the personal plan of the selected client
	
	//pull details
	$.ajax({
		url: "./rest/personalplan/" + $.cookie('user_id') + "/" + $.cookie('auth_token') + "/" + $(el).attr("id"),
		type:"get",
		contentType: "application/json",
		success: function(d) { // d = json returned
			
			clientName = d.clientDetails.personalDetails.preferredName;
			
			/* ------------------------------ CLIENT DETAILS --------------------------------------- */
			//Personal details
			var personalDetails = new Object();		
			personalDetails.creationDate = d.clientDetails.personalDetails.creationDate;
			personalDetails.preferredName = d.clientDetails.personalDetails.preferredName;
			personalDetails.reviewDate = d.clientDetails.personalDetails.reviewDate;
			personalDetails.dob = d.clientDetails.personalDetails.dob;
			personalDetails.email = d.clientDetails.personalDetails.email;
			personalDetails.phoneNumber = d.clientDetails.personalDetails.phoneNumber;
			personalDetails.mobileNumber = d.clientDetails.personalDetails.mobileNumber;
			
			//Alert information
			var alertInformation = new Object();
			alertInformation.allergies = d.clientDetails.alertInformation.allergies;
			alertInformation.complexSupportNeeds = d.clientDetails.alertInformation.complexSupportNeeds;
			alertInformation.eatingAlerts = d.clientDetails.alertInformation.eatingAlerts;
			alertInformation.guardianOrders = d.clientDetails.alertInformation.guardianOrders;
			alertInformation.medIssues = d.clientDetails.alertInformation.medIssues;
			alertInformation.otherInfo = d.clientDetails.alertInformation.otherInfo;
			alertInformation.phobias = d.clientDetails.alertInformation.phobias;
			alertInformation.restrictive = d.clientDetails.alertInformation.restrictive;
			alertInformation.safetyConcerns = d.clientDetails.alertInformation.safetyConcerns;
			
			//Formal orders
			var formalOrders = new Object();
			formalOrders.appointee = d.clientDetails.formalOrders.appointee;
			formalOrders.commenceDate = d.clientDetails.formalOrders.commenceDate;
			formalOrders.contactArrangement = d.clientDetails.formalOrders.contactArrangement;
			formalOrders.details = d.clientDetails.formalOrders.details;
			formalOrders.familyContact = d.clientDetails.formalOrders.familyContact;
			formalOrders.justiceRequirements = d.clientDetails.formalOrders.justiceRequirements;
			formalOrders.orderFor = d.clientDetails.formalOrders.orderFor;
			formalOrders.orderLocation = d.clientDetails.formalOrders.orderLocation;
			formalOrders.otherInfo = d.clientDetails.formalOrders.otherInfo;
			formalOrders.protectionOrder = d.clientDetails.formalOrders.protectionOrder;
			formalOrders.specialConditions = d.clientDetails.formalOrders.specialConditions;
			formalOrders.childSupportOfficer = d.clientDetails.formalOrders.childSupportOfficer;
			formalOrders.visitorInfo = d.clientDetails.formalOrders.visitorInfo;
			
			//Living arrangements
			var livingArangements = new Object();
			livingArangements.address = d.clientDetails.livingArangements.address;		
			livingArangements.phoneNumber = d.clientDetails.livingArangements.phoneNumber;
			livingArangements.service = d.clientDetails.livingArangements.service;
			livingArangements.sickContact = d.clientDetails.livingArangements.sickContact;
			
			//Add data to the clientdetails object
			var clientDetails = new Object();
			clientDetails.personalDetails = personalDetails;
			clientDetails.alertInformation = alertInformation;
			clientDetails.formalOrders = formalOrders;
			clientDetails.livingArangements = livingArangements;
			
			/* ----------------------------- HEALTH DETAILS --------------------------------------- */
			//Dietary requirements
			var dietaryRequirements = new Object();
			dietaryRequirements.assessmentDone = d.healthDetails.dietaryRequirements.assessmentDone;
			dietaryRequirements.avoidFood = d.healthDetails.dietaryRequirements.avoidFood;
			dietaryRequirements.breakfast = d.healthDetails.dietaryRequirements.breakfast;
			dietaryRequirements.cannotEat = d.healthDetails.dietaryRequirements.cannotEat;
			dietaryRequirements.dinner = d.healthDetails.dietaryRequirements.dinner;
			dietaryRequirements.dislikes = d.healthDetails.dietaryRequirements.dislikes;
			dietaryRequirements.eatingSupport = d.healthDetails.dietaryRequirements.eatingSupport;
			dietaryRequirements.location = d.healthDetails.dietaryRequirements.location;
			dietaryRequirements.lunch = d.healthDetails.dietaryRequirements.lunch;
			dietaryRequirements.otherInfo = d.healthDetails.dietaryRequirements.otherInfo;
			dietaryRequirements.snacks = d.healthDetails.dietaryRequirements.snacks;
			dietaryRequirements.supportDrinking = d.healthDetails.dietaryRequirements.supportDrinking;
			dietaryRequirements.usualDiet = d.healthDetails.dietaryRequirements.usualDiet;
			
			//Health information
			var healthInformation = new Object();
			healthInformation.additionalInfo = d.healthDetails.healthInformation.additionalInfo;
			healthInformation.assistanceWithMedication = d.healthDetails.healthInformation.assistanceWithMedication;
			healthInformation.conditions = d.healthDetails.healthInformation.conditions;
			healthInformation.historyAndInfo = d.healthDetails.healthInformation.historyAndInfo;
			healthInformation.selfMedicate = d.healthDetails.healthInformation.selfMedicate;
			healthInformation.takeMedication = d.healthDetails.healthInformation.takeMedication;
			
			//Health management
			var healthManagement = new Object();
			healthManagement.duration = d.healthDetails.healthManagement.duration;
			healthManagement.frequency = d.healthDetails.healthManagement.frequency;
			healthManagement.frequencyPeriod = d.healthDetails.healthManagement.frequencyPeriod;
			healthManagement.medicalCondition = d.healthDetails.healthManagement.medicalCondition;
			healthManagement.precurser = d.healthDetails.healthManagement.precurser;
			healthManagement.seizureBrief = d.healthDetails.healthManagement.seizureBrief;
			healthManagement.seizureNonBrief = d.healthDetails.healthManagement.seizureNonBrief;
			healthManagement.staffRespsonse = d.healthDetails.healthManagement.staffResponse;
			healthManagement.symptom = d.healthDetails.healthManagement.symptom;
			healthManagement.symptomAvoidance = d.healthDetails.healthManagement.symptomAvoidance;
					
			//Add data to the health details object
			var healthDetails = new Object();
			healthDetails.dietaryRequirements = dietaryRequirements;
			healthDetails.healthInformation = healthInformation;
			healthDetails.healthManagement = healthManagement;
			
			/* ---------------------------- COMMUNICATION --------------------------------------- */
			//Coms and decision making
			var comsAndDecisionMaking = new Object();
// 			comsAndDecisionMaking.dislikes = d.communication.comsAndDecisionMaking.dislikes;
// 			//do not talk about object
// 			var doNotTalkAbout = new Object();
// 			doNotTalkAbout.topic = d.communication.comsAndDecisionMaking.doNotTalkAbout.topic;
// 			doNotTalkAbout.translation = d.communication.comsAndDecisionMaking.doNotTalkAbout.translation;
// 			//add 
// 			comsAndDecisionMaking.doNotTalkAbout = doNotTalkAbout;
			
			comsAndDecisionMaking.dislikes = d.communication.comsAndDecisionMaking.dislikes;
			comsAndDecisionMaking.goodTopics = d.communication.comsAndDecisionMaking.goodTopics;
			comsAndDecisionMaking.iCommunicate = d.communication.comsAndDecisionMaking.iCommunicate;
			comsAndDecisionMaking.independantDecisions = d.communication.comsAndDecisionMaking.independantDecisions;
			comsAndDecisionMaking.likes = d.communication.comsAndDecisionMaking.likes;
			comsAndDecisionMaking.supportMeBy = d.communication.comsAndDecisionMaking.supportMeBy;
			comsAndDecisionMaking.supportPeople = d.communication.comsAndDecisionMaking.supportPeople;
			comsAndDecisionMaking.youCommunicate = d.communication.comsAndDecisionMaking.youCommunicate;
			
			var communication = new Object();
			communication.comsAndDecisionMaking = comsAndDecisionMaking;
			
			/* ------------------------- EDUCATION EMPLOYMENT --------------------------------------- */
			//Education
			var education = new Object();
			education.address = d.educationEmployment.education.address;
			education.communityAssistance = d.educationEmployment.education.communityAssistance;
			education.contactPerson = d.educationEmployment.education.contactPerson;
			education.eduSupportPlan = d.educationEmployment.education.eduSupportPlan;
			education.enrolledCourse = d.educationEmployment.education.enrolledCourse;
			education.institutionName = d.educationEmployment.education.institutionName;
			education.liaison = d.educationEmployment.education.liason;
			education.otherSupportRequired = d.educationEmployment.education.otherSupportRequired;
			education.studySupport = d.educationEmployment.education.studySupport;
			education.supportPersons = d.educationEmployment.education.supportPersons;
			education.teacher = d.educationEmployment.education.teacher;
			
			//Employment
			var employment = new Object();
			employment.address = d.educationEmployment.employment.address;
			employment.annualLeave = d.educationEmployment.employment.annualLeave;
			employment.arrangements = d.educationEmployment.employment.arrangements;
			employment.contactPerson = d.educationEmployment.employment.contactPerson;
			employment.employer = d.educationEmployment.employment.employer;
			employment.equipment = d.educationEmployment.employment.equipment;
			employment.position = d.educationEmployment.employment.position;
			employment.sickLeave = d.educationEmployment.employment.sickLeave;
			employment.transport = d.educationEmployment.employment.transport;
			
			//Add data to education employment object
			var educationEmployment = new Object();
			educationEmployment.education = education;
			educationEmployment.employment = employment;
			
			/* --------------------------- PLANNING ------------------------------------------------- */
			//Holiday plan
			var holidayPlan = new Object();
			holidayPlan.holidayType = $("#holidayT").val();
			holidayPlan.detailsAndInfo = $("#detailsT").val();
			holidayPlan.howWhoWhere = $("#howT").val();
			holidayPlan.resourcesRequired = $("#resourcesT").val();
			holidayPlan.strategies = $("#stratT").val();
			holidayPlan.timeframes = $("#timeframeT").val();
			//Goal plan
            var goalPlan = new Object();
			goalPlan.goalToAchieve = $("#myGoalT").val();
			goalPlan.howWhoWhere = $("#goalHowT").val();
			goalPlan.outcomes = $("#goalOutcomeT").val();
			goalPlan.resourcesRequired = $("#goalResourcesT").val();
			goalPlan.strategies = $("#goalStratT").val();
			goalPlan.timeframes = $("#goalTimesframesT").val();
		
            var planning = new Object();
            planning.holidayPlan = holidayPlan;
            planning.goalPlan = goalPlan;
			
			/* ---------------------- SUPPORT REQUIRED ---------------------------------------------- */
			//General support
			var generalSupport = new Object();
			generalSupport.crowdSafety = d.supportRequired.generalSupport.crowdSafety;
			generalSupport.strangerDanger = d.supportRequired.generalSupport.strangerDanger;
			generalSupport.moneyHandling = d.supportRequired.generalSupport.moneyHandling;
			generalSupport.crowds = d.supportRequired.generalSupport.crowds;
			generalSupport.socialNetworks = d.supportRequired.generalSupport.socialNetworks;
			generalSupport.communications = d.supportRequired.generalSupport.communications;
			generalSupport.eatingOut = d.supportRequired.generalSupport.eatingOut;
			generalSupport.beliefs = d.supportRequired.generalSupport.beliefs;
			generalSupport.lesiure = d.supportRequired.generalSupport.leisure;
			generalSupport.usingApplicances = d.supportRequired.generalSupport.usingApplicances;
			generalSupport.usingChemical = d.supportRequired.generalSupport.usingChemical;
			generalSupport.hazardRecognition = d.supportRequired.generalSupport.hazardRecognition;
			generalSupport.otherSafetyInfo = d.supportRequired.generalSupport.otherSafetyInfo;
		
			//mobility and transport
			var mobilityAndTransport = new Object();
			mobilityAndTransport.height = d.supportRequired.mobilityAndTransport.height;
			mobilityAndTransport.liftsAndEscalators = d.supportRequired.mobilityAndTransport.liftsAndEscalators;
			mobilityAndTransport.mobilityAids = d.supportRequired.mobilityAndTransport.mobilityAids;
			mobilityAndTransport.otherTravelSupport = d.supportRequired.mobilityAndTransport.otherTravelSupport;
			mobilityAndTransport.publicTransport = d.supportRequired.mobilityAndTransport.publicTransport;
			mobilityAndTransport.roadSafetySkills = d.supportRequired.mobilityAndTransport.roadSafetySkills;
			mobilityAndTransport.travelPreferences = d.supportRequired.mobilityAndTransport.travelPreferences;
			mobilityAndTransport.unevenSurfaces = d.supportRequired.mobilityAndTransport.unevenSurfaces;
			
			//financial support
			var financialSupport = new Object();
			financialSupport.budgetBills = d.supportRequired.financialSupport.budgetBills; 
			financialSupport.budgetConstraintGoal = d.supportRequired.financialSupport.budgetConstraintGoal;
			financialSupport.budgetEmergency = d.supportRequired.financialSupport.budgetEmergency;
			financialSupport.budgetExpend = d.supportRequired.financialSupport.budgetExpend;
			financialSupport.budgetGroceries = d.supportRequired.financialSupport.budgetGroceries;
			financialSupport.budgetHouse = d.supportRequired.financialSupport.budgetHouse;
			financialSupport.budgetSupportNetwork = d.supportRequired.financialSupport.budgetSupportNetwork;
			financialSupport.budgetTransport = d.supportRequired.financialSupport.budgetTransport;
			financialSupport.budgetUtilities = d.supportRequired.financialSupport.budgetUtilities;
			financialSupport.budgeting = d.supportRequired.financialSupport.budgeting;
			financialSupport.financialAdmin = d.supportRequired.financialSupport.financialAdmin;
			financialSupport.moneyHandlingSupport = d.supportRequired.financialSupport.moneyHandlingSupport;
			financialSupport.otherRequirements = d.supportRequired.financialSupport.otherRequirements;
			financialSupport.personalItemsSupport = d.supportRequired.financialSupport.personalItemsSupport;
			
			//Daily activities
			var dailyActivities = new Object();
			dailyActivities.bathing = d.supportRequired.dailyActivities.bathing;
			dailyActivities.bedTime = d.supportRequired.dailyActivities.bedTime;
			dailyActivities.cleaning = d.supportRequired.dailyActivities.cleaning;
			dailyActivities.cooking = d.supportRequired.dailyActivities.cooking;
			dailyActivities.dressing = d.supportRequired.dailyActivities.dressing;
			dailyActivities.friday = d.supportRequired.dailyActivities.friday;
			dailyActivities.menstruation = d.supportRequired.dailyActivities.menstruation;
			dailyActivities.monday = d.supportRequired.dailyActivities.monday;
			dailyActivities.otherThings = d.supportRequired.dailyActivities.otherThings;
			dailyActivities.routineAfternoon = d.supportRequired.dailyActivities.routineAfternoon;
			dailyActivities.routineMealTime = d.supportRequired.dailyActivities.routineMealTime;
			dailyActivities.routineMorning = d.supportRequired.dailyActivities.routineMorning;
			dailyActivities.routineSleeping = d.supportRequired.dailyActivities.routineSleeping;
			dailyActivities.routineWeekend = d.supportRequired.dailyActivities.routineWeekend;
			dailyActivities.saturday = d.supportRequired.dailyActivities.saturday;
			dailyActivities.sleeping = d.supportRequired.dailyActivities.sleeping;
			dailyActivities.sunday = d.supportRequired.dailyActivities.sunday;
			dailyActivities.thursday = d.supportRequired.dailyActivities.thursday;
			dailyActivities.toileting = d.supportRequired.dailyActivities.toileting;
			dailyActivities.tuesday = d.supportRequired.dailyActivities.tuesday;
			dailyActivities.wednesday = d.supportRequired.dailyActivities.wednesday;
		
			//relaxation
			var relaxation = new Object();
			relaxation.activities = d.supportRequired.relaxation.activities;
			relaxation.movie = d.supportRequired.relaxation.movie;
			relaxation.music = d.supportRequired.relaxation.music;
			relaxation.otherActivities = d.supportRequired.relaxation.otherActivities;
			relaxation.tVShow = d.supportRequired.relaxation.tVShow;
			
			var supportRequired = new Object();
			supportRequired.generalSupport = generalSupport;
			supportRequired.mobilityAndTransport = mobilityAndTransport;
			supportRequired.financialSupport = financialSupport;
			supportRequired.dailyActivities = dailyActivities;
			supportRequired.relaxation = relaxation;
			
			//Add data to personal plan
			personalPlan.clientDetails = clientDetails;
			personalPlan.healthDetails = healthDetails;
			personalPlan.communication = communication;
			personalPlan.edcuationEmployment = educationEmployment;
 			personalPlan.planning = planning;
 			personalPlan.supportRequired = supportRequired;
			
		},
		error: function(xhr) {
			// do something to handle error
			
		}
	});
	
	if (personalPlan != null) {
		
		//Create the PDF
		alert("PDF Being Generated");
		
		//Create today's date
		var d =  new Date();
		var month = d.getMonth()+1;
		var day = d.getDate();
		var date = ((''+day).length<2 ? '0' : '') + day + '/' + ((''+month).length<2 ? '0' : '') + month + '/' + d.getFullYear();
			
		//do shit (add shit to pdf)
		var doc = new jsPDF();
		
		//set document properties
		doc.setProperties({
			title: clientName +  ' Personal Plan', // client id + personal plan $(el).attr("id")+
			subject: 'Client Personal Plan',	//personal plan	
			author: $.cookie('user_id'), //user id
		});
		
		doc.setFontType("bold");
		doc.text(90, 10, 'Personal Plan');
		
		/* -------------------------------- CLIENT DETAILS --------------------------------------*/
		doc.text(10, 15, 'Client Details');
		//Personal details
		doc.text(10, 20, 'Personal Details');
		doc.setFontType("normal"); //set font type back to normal
		doc.text(10, 25, 'Creation Date: ' + personalPlan.clientDetails.personalDetails.creationDate);
		doc.text(10, 30, 'Preferred Name: ' + personalPlan.clientDetails.personalDetails.preferredName);
		doc.text(10, 35, 'Review Date: ' + personalPlan.clientDetails.personalDetails.reviewDate);
		doc.text(10, 40, 'Date of Birth: ' + personalPlan.clientDetails.personalDetails.dob);
		doc.text(10, 45, 'Email Address: ' + personalPlan.clientDetails.personalDetails.email);
		doc.text(10, 50, 'Phone Number: ' + personalPlan.clientDetails.personalDetails.phoneNumber);
		doc.text(10, 55, 'Mobile Number: ' + personalPlan.clientDetails.personalDetails.mobileNumber);
		//Alert information
		doc.setFontType("bold");
		doc.text(10, 65, 'Alert Information');
		doc.setFontType("normal");
		
		//Formal orders
		doc.setFontType("bold");
		doc.text(10, 75, 'Formal Orders');
		doc.setFontType("normal"); 
		
		//Living arrangements
		doc.setFontType("bold");
		doc.text(10, 85, 'Living Arrangements');
		doc.setFontType("normal"); 
		
		
		/* -------------------------------- HEALTH DETAILS --------------------------------------*/
		doc.setFontType("bold");
		doc.text(10, 95, 'Health Details');
		//Dietary requirements
		doc.text(10, 100, 'Dietary Requirements');
		doc.setFontType("normal");
		
		//Health information
		doc.text(10, 105, 'Health Information');
		doc.setFontType("normal");
		
		//Health management
		doc.text(10, 110, 'Health Management');
		doc.setFontType("normal");
		
		
		/* -------------------------------- COMMUNICATION --------------------------------------*/
		doc.setFontType("bold");
		doc.text(10, 120, 'Communication');
		doc.setFontType("normal");
		
		
		
		
		//Prompt the user to save the pdf
		doc.save($(el).attr("id") + '_personal_plan' + date);
	}
}


$(document).ready(function(){
	
	//page loads
	//get list of existing clients
	$.ajax({
		url: "./rest/personalplan/allclientswithplans/" + $.cookie('user_id') + "/" + $.cookie('auth_token'),
		type:"get",
		contentType: "application/json",
		success: function(d) {
			$("#searchResults").html("");
			var content = "<table>"
			content += "<tr><th>Client ID</th><th>Name</th><th>DOB</th><th>Mobile</th><th>Telephone</th></tr>";
			for (var i = 0; i < d.existingPlanDetails.length; i++) {
				content += "<tr><td class='fakeLink' id='" + d.existingPlanDetails[i].user_id + "'onClick='selectPP(this);'>" + d.existingPlanDetails[i].user_id + "</td>";
				content += "<td>" + d.existingPlanDetails[i].rName + "</td>";
				content += "<td>" + d.existingPlanDetails[i].dob + "</td>";
				content += "<td>" + d.existingPlanDetails[i].mobile + "</td>";
				content += "<td>" + d.existingPlanDetails[i].telephone + "</td></tr>";
			}
			content += "</table>";
			$("#searchResults").append(content);
		},
		error: function(xhr) {
			// do something to handle error
			alert("error getting existing personal plan details");
		}
	});
	
	
	//click on search button
	$("#queryB").click(function(){
		$.ajax({
			url: "./rest/personalplan/allclientswithplans/" + $.cookie('user_id') + "/" + $.cookie('auth_token'),
			type:"get",
			contentType: "application/json",
			success: function(d) {
				$("#searchResults").html("");
				var content = "<table>"
				content += "<tr><th>Client ID</th><th>Name</th><th>DOB</th><th>Mobile</th><th>Telephone</th></tr>";
				for (var i = 0; i < d.existingPlanDetails.length; i++) {
					if(d.existingPlanDetails[i].user_id == $("#queryT").val() || $("#queryT").val()=="") {
						content += "<tr><td>" + d.existingPlanDetails[i].user_id + "</td>";
						content += "<td>" + d.existingPlanDetails[i].rName + "</td>";
						content += "<td>" + d.existingPlanDetails[i].dob + "</td>";
						content += "<td>" + d.existingPlanDetails[i].mobile + "</td>";
						content += "<td>" + d.existingPlanDetails[i].telephone + "</td></tr>";
					}
				}
				content += "</table>";
				$("#searchResults").append(content);
			},
			error: function(xhr) {
				// do something to handle error
				alert("error getting existing personal plan details");
			}
		});
	});
});
</script>